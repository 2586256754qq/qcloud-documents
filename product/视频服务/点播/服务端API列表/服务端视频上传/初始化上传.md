## 接口名称
InitUpload

## 功能说明
1. APP后台可以通过将自己服务器上的本地视频上传到点播服务端，整个上传过程涉及初始化上传、分片上传、结束上传三步，具体流程参见下图；
1. 支持秒传、断点续传；
1. 接口本身逻辑较为复杂，点播封装了多种语言的SDK来简化开发者的调用；我们建议开发者直接使用视频上传SDK来实现服务端本地视频上传逻辑，而不是手工调用本地视频上传接口；
1. 对于将移动端、Web端视频上传到点播服务端的需求（UGC），请直接使用点播UGC SDK，参见UGC视频上传综述。


## 请求方式

### 请求域名
vod2.qcloud.com

> 注意：
> - 服务端视频上传的域名与其他服务端API不同，*不是* vod.api.qcloud.com；
> - 该接口仅支持GET方法，不支持POST方法。

### 参数说明
| 参数名称 | 必填 | 类型 | 说明 |
|---------|---------|---------|---------|
| Action | 是 | String | 命令字，填InitUpload |
| fileName | 是 | String | 视频文件本地名称，如果包含中文空格，则需要使用rawurlencode编码，长度在40个字符以内，不得包含\ / : * ? “ < > \| 等字符 |
| fileSha | 是 | String | 视频文件的sha，采用SHA-1计算文件内容 |
| fileSize | 是 | Int64 | 视频文件的总大小，单位字节Byte |
| dataSize | 是 | Int | 本次上传的分片大小，单位字节Byte。dataSize值取值范围[524288~5242880]（非最后分片，第一个分片固定524288） |
| fileType | 是 | String | 视频文件的类型，根据后缀区分 |
| tags.n | 否 | String | 视频的标签列表 |
| classId | 否 | Int | 视频的分类ID |
| isTranscode | 否 | Int | 是否转码，0：否，1：是，默认为0；如果不执行转码，可在上传后，在管理控制台视频文件管理进行转码； |
| isScreenshot | 否 | Int | 是否截图，0：否，1：是，默认为0 |
| isWatermark | 否 | Int | 是否打水印，0：否，1：是，默认为0；如果选择打水印，请务必在管理控制台提前完成水印文件选择和位置设定，否则可能导致上传失败； |
| extra.usage | 否 | Int | 其他文件类型，不填表示是视频。填1表示上传视频封面 |
| extra.file_id | 否 | String | extra.usage=1时填，表示封面对应的视频id |

### 请求示例
```
https://vod2.qcloud.com/v2/index.php?Action=InitUpload
&fileName=test
&fileSha=b4a5c70c76e79e01ab3a5c306de3d9eedeadeca9
&fileSize=20350000
&dataSize=1048576
&fileType=mp4
&COMMON_PARAMS
```

## 接口应答

### 参数说明
| 参数名称 | 类型 | 说明 |
|---------|---------|---------|
| code | Int | 小于0：失败；0：初始化成功，可以进行分片上传；1：文件部分存在，可以继续上传缺失的部分（断点续传）；2：文件已存在，无需上传（秒传） |
| message | String | 返回信息说明 |
| listParts.offset | Int64 | 分片相对偏移，code=1时存在 |
| listParts.dataSize | Int | 分片大小，code=1时存在 |
| listParts.dataMd5 | String | 分片md5，code=1时存在 |
| codeDesc | String | 后台记录的错误信息，腾讯云后台定位用 |
| dataSize | Int | 分片大小，code=1 时返回，前端需以此值为准 |
| fileId | String | 文件id，code=2 时返回 |
| canRetry | Int | code<0 时，是否可重试 |

### 错误码说明
| 错误码 | 含义说明|
|---------|---------|
| 4000-7000 | 参见公共错误码。  |
| xxx | 说明说明说明说明  |
| yyy | 说明说明说明说明 |

### 应答示例

正常上传：
```javascript
{
    "code": 0,
    "message": "",
    "codeDesc": "",
    "canRetry": 0
}
```

断点续传：
```javascript
{
    "code": 1,
    "message": "",
    "codeDesc": "",
    "canRetry": 0,
    "listParts": [
        {
            "offset": 0,
            "dataSize": 1024,
            "dataMd5": "xxx......"
        },
        {
            "offset": 1024,
            "dataSize": 1024,
            "dataSha": "xxx......"
        }
    ]
}
```

秒传：
```javascript
{
    "code": 2,
    "message": "",
    "codeDesc": "",
    "canRetry": 0,
    "fileId": "7031868222808505913"
}
```
