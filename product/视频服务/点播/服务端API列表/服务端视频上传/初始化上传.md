## #  #接口名称
InitUpload

## 功能说明
1. APP后台可以通过将自己服务器上的本地视频上传到点播服务端，整个上传过程涉及初始化上传、分片上传、结束上传三步，具体流程参见下图；
1. 支持秒传、断点续传；
1. 接口本身逻辑较为复杂，点播封装了多种语言的SDK来简化开发者的调用；我们建议开发者直接使用视频上传SDK来实现服务端本地视频上传逻辑，而不是手工调用本地视频上传接口；
1. 对于将移动端、Web端视频上传到点播服务端的需求（UGC），请直接使用点播UGC SDK，参见UGC视频上传综述。


## 请求方式

### 请求域名
vod2.qcloud.com

### 最高调用频率
100次/分钟

> 注意：
> - 服务端视频上传的域名与其他服务端API不同，*不是* vod.api.qcloud.com；
> - 该接口仅支持GET方法，不支持POST方法。

### 参数说明
| 参数名称 | 必填 | 类型 | 说明 |
|---------|---------|---------|---------|
| fileName | 是 | String | 视频文件本地名称，如果包含中文空格，则需要使用rawurlencode编码，长度在40个字符以内，不得包含\ / : * ? “ < > \| 等字符 |
| fileSha | 是 | String | 视频文件的sha，采用SHA-1计算文件内容 |
| fileSize | 是 | Integer | 视频文件的总大小，单位字节Byte |
| dataSize | 是 | Integer | 上传的分片大小，单位字节Byte。dataSize值取值范围[524288~1048576]。 |
| fileType | 是 | String | 视频文件的类型，根据后缀区分 |
| tags.n | 否 | String | 视频的标签列表 |
| classId | 否 | Integer | 视频的分类ID |
| isTranscode | 否 | Integer | 是否转码，0：否，1：是，默认为0；如果不执行转码，可在上传后，在管理控制台视频文件管理进行转码； |
| isScreenshot | 否 | Integer | 是否截图，0：否，1：是，默认为0 |
| isWatermark | 否 | Integer | 是否打水印，0：否，1：是，默认为0；如果选择打水印，请务必在管理控制台提前完成水印文件选择和位置设定，否则可能导致上传失败； |


### 请求示例
```
https://vod2.qcloud.com/v2/index.php?Action=InitUpload
&fileName=test
&fileSha=b4a5c70c76e79e01ab3a5c306de3d9eedeadeca9
&fileSize=20350000
&dataSize=1048576
&fileType=mp4
&COMMON_PARAMS
```

## 接口应答

### 参数说明
| 参数名称 | 类型 | 说明 |
|---------|---------|---------|
| code | Integer | 小于0：失败；0：初始化成功，可以进行分片上传；1：文件部分存在，可以继续上传缺失的部分（断点续传）；2：文件已存在，无需上传（秒传） |
| message | String | 返回信息说明 |
| listParts.offset | Int64 | 分片相对偏移，code=1时存在 |
| listParts.dataSize | Integer | 分片大小，code=1时存在 |
| listParts.dataMd5 | String | 分片md5，code=1时存在 |
| codeDesc | String | 后台记录的错误信息 |
| dataSize | Integer | 分片大小，code=1 时返回，前端需以此值为准 |
| fileId | String | 文件id，code=2 时返回 |
| canRetry | Integer | code<0 时，是否可重试，canRetry=1时可重试 |

### 错误码说明
| 错误码 | 含义说明|
|---------|---------|
| -10001 | 检查公共参数出错 |
| -10002 | 检查签名出错 |
| -10003 | 检查协议参数出错 |
| -10004 | 写缓存信息失败 |
| -10005 | 获取缓存信息失败|
| -10006 | 包体非法 |
其他错误码可能为网络原因导致的偶发失败。所有小于0的错误码，当canRetry=1时，均可重试解决。
### 应答示例

正常上传：
```javascript
{
    "code": 0,
    "message": "",
    "codeDesc": "",
    "canRetry": 0
}
```

断点续传：
```javascript
{
    "code": 1,
    "message": "",
    "codeDesc": "",
    "canRetry": 0,
    "listParts": [
        {
            "offset": 0,
            "dataSize": 1048576,
            "dataMd5": "xxx......"
        },
        {
            "offset": 1048576,
            "dataSize": 1048576,
            "dataSha": "xxx......"
        }
    ]
}
```
